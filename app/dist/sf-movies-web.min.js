/* sf-movies-web 1.0.0 */
"use strict";angular.module("sfMovies",[]),angular.element(document).ready(function(){angular.bootstrap(document,["sfMovies"])}),angular.module("sfMovies").directive("bocAutocomplete",function(){var a="q"+Math.round(1e3*Math.random());return{replace:!0,restrict:"E",template:'<input type="search" id="'+a+'" name="'+a+'">',link:function(a,b,c){new window.Autocomplete(b[0],{url:c.url,param:c.sparam,label:c.stext,value:c.svalue,select:function(b){a.selected(b)}})}}}),angular.module("sfMovies").directive("googleMap",["googleMapLoader","mapService",function(a,b){return{replace:!0,restrict:"E",link:function(c,d){for(var e=[],f=d.children(),g=0;g<f.length;g++)e.push(f[g]);a.then(function(a){d.html('<div id="map-canvas"></div>'),b.initialize(a,d[0].children[0]),e.forEach(function(a){b.addControl(a,a.getAttribute("data-position"))})})}}}]),angular.module("sfMovies").service("googleMapLoader",["$window","$document","$q",function(a,b,c){var d=function(){return angular.isDefined(a.google)&&angular.isDefined(a.google.maps)},e=c.defer(),f=function(){var c="initialize"+Math.round(1e3*Math.random());a[c]=function(){a[c]=null,e.resolve(window.google.maps)};var d=b[0].createElement("script");return d.type="text/javascript",d.src="https://maps.googleapis.com/maps/api/js?callback="+c,b[0].body.appendChild(d)};return d()?e.resolve(window.google.maps):f(),e.promise}]),angular.module("sfMovies").service("mapService",function(){var a,b,c,d,e=[];return{initialize:function(e,f){d=e,a=new e.LatLng(37.7577,-122.4376),b={center:a,zoom:11,mapTypeControl:!1,streetViewControl:!1,streetViewControlOptions:{position:e.ControlPosition.RIGHT_CENTER},overviewMapControl:!1,panControl:!1,zoomControl:!0,zoomControlOptions:{position:e.ControlPosition.RIGHT_CENTER}},c=new e.Map(f,b)},addControl:function(a,b){if(!c)throw"map is not initialized";c.controls[d.ControlPosition[b]].push(a)},setOptions:function(a){c.setOptions(a)},clearMarkers:function(){e.forEach(function(a){a.setMap(null)}),e=[]},plotLocation:function(a,b,f){var g=new d.LatLng(a,b),h=new d.Marker({position:g,map:c,animation:d.Animation.DROP});e.push(h),f&&d.event.addListener(h,"click",f)},zoomView:function(a,b){c.setCenter(new d.LatLng(a,b)),c.setZoom(14)},streetView:function(a,b){var d=c.getStreetView();d.setPosition({lat:a,lng:b}),d.setVisible(!0)},roadmapView:function(a,b){c.setCenter(new d.LatLng(a,b)),c.setZoom(14),c.setMapTypeId(d.MapTypeId.ROADMAP)},sateliteView:function(a,b){c.setCenter(new d.LatLng(a,b)),c.setZoom(20),c.setMapTypeId(d.MapTypeId.SATELLITE),c.setTilt(45),c.setHeading(90)},reset:function(){c.setZoom(11),c.setCenter(a),c.setMapTypeId(d.MapTypeId.ROADMAP)}}}),angular.module("sfMovies").service("omdbService",["$window","$q",function(a,b){return{getContent:function(c){var d=b.defer();return a.omdb.get({title:c.title,year:parseInt(c.releaseYear,10)},function(a,b){if(a)d.reject("error fetching omdb content");else{var c={};c.poster=b.Poster,c.plot=b.Plot,c.poster=b.Poster,c.genre=b.Genre,c.actors=b.Actors,c.rating=b.imdbRating,d.resolve(c)}}),d.promise}}}]),angular.module("sfMovies").controller("locationController",["$rootScope","$scope","mapService",function(a,b,c){a.$on("locationSelected",function(a,d){c.zoomView(d.geo.lat,d.geo.lng),b.$apply(function(){b.location=d,b.$parent.showMovie=!1,b.showLocation=!0})}),b.backToFilm=function(){c.reset(),b.$parent.showMovie=!0,b.showLocation=!1},b.sateliteView=function(){c.sateliteView(b.location.geo.lat,b.location.geo.lng),b.isSateliteView=!0},b.roadmapView=function(){c.roadmapView(b.location.geo.lat,b.location.geo.lng),b.isSateliteView=!1},b.streetView=function(){c.streetView(b.location.geo.lat,b.location.geo.lng)}}]),angular.module("sfMovies").controller("movieController",["$rootScope","$scope","$http","mapService","omdbService",function(a,b,c,d,e){a.$on("movieSelected",function(f,g){d.setOptions({streetViewControl:!1,zoomControl:!0}),d.clearMarkers(),b.movie=g,b.showMovie=!0,e.getContent(g).then(function(a){angular.extend(b.movie,a)},function(){console.log("error")}),c.get("/movies/locations?title="+encodeURIComponent(g.title)+"&director="+encodeURIComponent(g.director)).success(function(b){b.locations.forEach(function(b){d.plotLocation(b.geo.lat,b.geo.lng,function(){a.$emit("locationSelected",b)})})}).error(function(a){console.log(a)})})}]),angular.module("sfMovies").controller("searchController",["$rootScope","$scope",function(a,b){b.selected=function(b){a.$emit("movieSelected",b)}}]);